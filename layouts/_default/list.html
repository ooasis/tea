{{- define "main" -}}

{{- $isTagPage := eq .Type "tags" -}}

<!-- Tag Title -->
{{- if and .Title (eq .Type "tags") -}}
<h1 class="mb-8 text-xl font-medium">#{{ .Title }}</h1>
{{- end -}}

<!-- Section content - show for section pages -->
{{- if .Content -}}
<div class="mb-12">
  {{- .Content -}}
</div>
{{- end -}}

<!-- $pages -->
{{- $pages := .Pages -}}<!---->
{{- if or .IsHome (eq .Kind "home") -}}<!---->
{{- $main := where site.RegularPages "Type" "in" site.Params.mainSections -}}<!---->
{{- if gt (len $main) 0 -}}
{{- $pages = $main -}}<!---->
{{- else -}}
{{- $pages = .Sections -}}<!---->
{{- end -}}
{{- end -}}

<!-- Articles -->
{{- $pagerSize := 5 -}}
{{- if $isTagPage -}}
{{- $pagerSize = 50 -}}
{{- end -}}
{{- $paginator := .Paginate $pages $pagerSize -}}
{{- if $isTagPage -}}
<div class="not-prose flex flex-col gap-2">
{{- end -}}
{{- range $index, $page := $paginator.Pages -}}<!---->

<!-- avatar -->
{{- if and (or $.IsHome (eq $.Kind "home")) (eq $paginator.PageNumber 1) (eq $index 0) -}}<!---->

{{- $avatar_url := $.Scratch.Get "avatar_url" -}}<!---->
{{- if or $avatar_url site.Params.name -}}
<div class="-mt-2 mb-12 flex items-center">
  {{- if $avatar_url -}}
  <div
    class="h-24 w-24 shrink-0 rounded-full border-[0.5px] border-black/10 bg-white/50 p-3 ltr:mr-5 ltr:-ml-1 rtl:-mr-1 rtl:ml-5 dark:bg-white/90!">
    <img class="not-prose my-0 h-full w-full rounded-full bg-black/5! hover:animate-spin dark:bg-black/80!"
      src="{{- $avatar_url -}}" alt="{{- site.Params.name | default site.Title -}}" />
  </div>
  {{- end -}}<!---->
  {{- if site.Params.name -}}
  <div>
    <div class="mt-3 mb-1 text-2xl font-medium text-black dark:text-white">
      {{- site.Params.name -}}
    </div>
    <div class="break-words">
      {{- site.Params.bio | default (print `A personal blog by `
      site.Params.name) -}}
    </div>
  </div>
  {{- end -}}
</div>
{{- end -}}<!---->

{{- end -}}

{{- if $isTagPage -}}
<a
  class="block px-1 py-1 no-underline hover:underline"
  href="{{ $page.RelPermalink }}"
>
  <div class="text-sm font-medium leading-snug">{{ $page.Title }}</div>
  {{- if or $page.Date (gt $page.Weight 0) -}}
  <div class="mt-1 text-xs opacity-60">
    {{- if $page.Date -}}
    {{ $page.Date | time.Format ":date_medium" }}
    {{- end -}}
    {{- if gt $page.Weight 0 -}}
    {{- if $page.Date -}}<span class="mx-1.5">&middot;</span>{{- end -}}<span class="text-orange-500">Featured</span>
    {{- end -}}
  </div>
  {{- end -}}
</a>
{{- else -}}
<section class="relative my-10 first-of-type:mt-0 last-of-type:mb-0">
  {{- if gt $page.Weight 0 -}}
  <span class="mb-1 inline-block text-xs tracking-wider text-orange-500">Featured</span>
  {{- end -}}
  <h2 class="my-0!">{{ $page.Title }}</h2>
  {{- if $page.Date -}}
  <time class="text-xs antialiased opacity-60">{{ $page.Date | time.Format ":date_medium" }}</time>
  {{- end -}}
  <a class="absolute inset-0 text-[0px]" href="{{- $page.Permalink -}}">{{- $page.Title -}}</a>
</section>
{{- end -}}
{{- end -}}
{{- if $isTagPage -}}
</div>
{{- end -}}

<!-- Main Nav -->
{{- if gt $paginator.TotalPages 1 -}}
<nav class="mt-14 flex">
  {{- if $paginator.HasPrev -}}
  {{- $pagerClass := "btn not-prose" -}}
  {{- if eq .Type "tags" -}}
  {{- $pagerClass = "btn btn-subtle not-prose" -}}
  {{- end -}}
  <a class="{{- $pagerClass -}}" href="{{- $paginator.Prev.URL -}}">← {{- i18n "prev_page" -}}</a>
  {{- end -}}<!---->
  {{- if $paginator.HasNext -}}
  {{- $pagerClassNext := "btn not-prose ml-auto" -}}
  {{- if eq .Type "tags" -}}
  {{- $pagerClassNext = "btn btn-subtle not-prose ml-auto" -}}
  {{- end -}}
  <a class="{{- $pagerClassNext -}}" href="{{- $paginator.Next.URL -}}">{{- i18n "next_page" -}} →</a>
  {{- end -}}
</nav>
{{- end -}}<!---->

<!-- Tags (clickable) -->
{{- partial "page-tags.html" . -}}

{{- end -}}


