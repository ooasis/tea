{{- define "main" -}}

<div class="home-layout">
  <!-- Left: main home content -->
  <div class="home-main">
    {{- if .Content -}}
    {{- .Content -}}
    {{- end -}}
  </div>

  <!-- Right: latest content (top 10, no pagination) -->
  <aside class="home-sidebar not-prose">
    <div class="home-sidebar-inner">
      <h2 class="home-latest-title">Latest</h2>

      {{- /*
        Only show "leaf" pages in the right-column Latest list:
        - Regular pages (Kind "page")
        - Or section pages (Kind "section") that have no children (.Sections and .Pages are empty)
        This avoids showing higher-level landing sections like /tea-varieties/ while still listing
        the actual end-node content pages in your current _index.md-based structure.
      */ -}}
      {{- $candidates := where site.Pages "Kind" "in" (slice "section" "page") -}}
      {{- $candidates = where $candidates "RelPermalink" "ne" "/" -}}

      {{- $leaf := slice -}}
      {{- range $candidates -}}
        {{- if and (eq .Kind "page") (eq .Weight 0) -}}
          {{- $leaf = $leaf | append . -}}
        {{- else if and (eq .Kind "section") (eq .Weight 0) (eq (len .Sections) 0) (eq (len .Pages) 0) -}}
          {{- $leaf = $leaf | append . -}}
        {{- end -}}
      {{- end -}}

      {{- $latest := first 10 (sort $leaf "Date" "desc") -}}

      <div class="home-latest-list">
        {{- range $latest -}}
        <a
          class="home-latest-item"
          href="{{- .RelPermalink -}}"
        >
          <div class="home-latest-item-title">{{- .Title -}}</div>
          {{- if .Date -}}
          <div class="home-latest-item-date">{{- .Date | time.Format ":date_medium" -}}</div>
          {{- end -}}
        </a>
        {{- end -}}
      </div>
    </div>
  </aside>
</div>

{{- end -}}

